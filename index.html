<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Sales Neon Dashboard</title>
<style>
    body {
        margin: 0;
        background: #071018;
        font-family: "Poppins", sans-serif;
        color: #d7e7ff;
    }

    .sidebar {
        width: 220px;
        background: #0c1624;
        height: 100vh;
        position: fixed;
        padding-top: 20px;
        box-shadow: 3px 0 10px rgba(0,0,0,0.4);
    }

    .side-btn {
        display: block;
        padding: 15px 20px;
        margin: 10px;
        background: #0f1d33;
        border-radius: 8px;
        cursor: pointer;
    }

    .side-btn.active {
        background: #0a5aff;
        box-shadow: 0 0 15px #0a5aff;
    }

    .header {
        margin-left: 240px;
        padding: 20px;
        font-size: 28px;
        font-weight: 600;
        color: #8bbaff;
        text-shadow: 0 0 12px #0047ff;
    }

    .content {
        margin-left: 240px;
        padding: 20px;
    }

    .cards {
        display: flex;
        gap: 20px;
        margin-top: 20px;
        flex-wrap: wrap;
    }

    .card {
        background: #0f1d33;
        padding: 25px;
        width: 220px;
        border-radius: 12px;
        cursor: pointer;
        text-align: center;
        box-shadow: 0 0 25px rgba(0, 100, 255, 0.2);
        transition: 0.2s;
    }

    .card:hover {
        box-shadow: 0 0 35px rgba(0, 100, 255, 0.45);
        transform: translateY(-4px);
    }

    .card h2 {
        margin: 0;
        font-size: 38px;
    }

    table {
        width: 100%;
        margin-top: 25px;
        border-collapse: collapse;
        background: #0f1d33;
        border-radius: 10px;
        overflow: hidden;
    }

    th {
        background: #0c1624;
        padding: 12px;
        color: #8bbaff;
        font-weight: 600;
        text-align: left;
    }

    td {
        padding: 12px;
        border-top: 1px solid #122238;
        color: #d8e4ff;
    }
</style>
</head>

<body>

<div class="sidebar">
    <div class="side-btn active" data-tab="sales">Sales</div>
    <div class="side-btn" data-tab="details">Details</div>
</div>

<div class="header" id="title">Sales Overview</div>

<div class="content">

    <!-- SALES SECTION -->
    <div id="sales-section">

        <div class="cards">
            <div class="card" id="assignedCard">
                <div>Assigned</div>
                <h2 id="assignedCount">0</h2>
            </div>

            <div class="card" id="acceptedCard">
                <div>Accepted</div>
                <h2 id="acceptedCount">0</h2>
            </div>

            <div class="card" id="revertedCard">
                <div>Reverted</div>
                <h2 id="revertedCount">0</h2>
            </div>
        </div>

    </div>

    <!-- DETAILS SECTION -->
    <div id="details-section" style="display:none;">
        <table>
            <thead>
                <tr>
                    <th>Sales Rep</th>
                    <th>Assigned</th>
                    <th>Transferred</th>
                    <th>COE</th>
                    <th>GS Lead</th>
                    <th>Reason</th>
                </tr>
            </thead>
            <tbody id="detailsBody"></tbody>
        </table>
    </div>

</div>

<script>
const API = "https://salesdashboard.ashishoct34.workers.dev/";

let MASTER = [];  // all rows (unsorted, raw)
let FILTERED = []; // rows for details page

function toDate(v) {
    if (!v || v.trim() === "") return "";
    const d = new Date(v);
    return isNaN(d) ? "" : d;
}

async function loadData() {
    const res = await fetch(API);
    const json = await res.json();

    MASTER = [];

    Object.values(json.data).forEach(arr => {
        arr.forEach(r => {
            MASTER.push({
                rep: r["sales rep"] || "",
                assigned: toDate(r["assigned date"]),
                transferred: toDate(r["transferred to gs date"]),
                coe: toDate(r["coe obtained date"]),
                gsLead: r["gs lead"] || "",
                reason: r["reason if reverted"] || ""
            });
        });
    });

    updateCards();
}

function updateCards() {
    const assigned = MASTER.filter(r => r.assigned !== "");
    const reverted = assigned.filter(r => r.reason.trim() !== "");
    const accepted = assigned.filter(r => r.reason.trim() === "");

    document.getElementById("assignedCount").textContent = assigned.length;
    document.getElementById("acceptedCount").textContent = accepted.length;
    document.getElementById("revertedCount").textContent = reverted.length;

    // card click â†’ show filtered list
    document.getElementById("assignedCard").onclick = () => showDetails(assigned);
    document.getElementById("acceptedCard").onclick = () => showDetails(accepted);
    document.getElementById("revertedCard").onclick = () => showDetails(reverted);
}

function showDetails(rows) {
    FILTERED = rows;

    // switch screen
    document.getElementById("sales-section").style.display = "none";
    document.getElementById("details-section").style.display = "block";
    document.getElementById("title").textContent = "Details";

    const TB = document.getElementById("detailsBody");
    TB.innerHTML = rows.map(r => `
        <tr>
            <td>${r.rep}</td>
            <td>${r.assigned ? r.assigned.toLocaleDateString("en-GB") : ""}</td>
            <td>${r.transferred ? r.transferred.toLocaleDateString("en-GB") : ""}</td>
            <td>${r.coe ? r.coe.toLocaleDateString("en-GB") : ""}</td>
            <td>${r.gsLead}</td>
            <td>${r.reason}</td>
        </tr>
    `).join("");
}

// NAVIGATION
document.querySelectorAll(".side-btn").forEach(btn => {
    btn.onclick = () => {
        document.querySelectorAll(".side-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        if (btn.dataset.tab === "sales") {
            document.getElementById("sales-section").style.display = "block";
            document.getElementById("details-section").style.display = "none";
            document.getElementById("title").textContent = "Sales Overview";
        }

        if (btn.dataset.tab === "details") {
            document.getElementById("sales-section").style.display = "none";
            document.getElementById("details-section").style.display = "block";
            document.getElementById("title").textContent = "Details";
            showDetails(FILTERED.length ? FILTERED : MASTER);
        }
    };
});

loadData();
</script>

</body>
</html>
